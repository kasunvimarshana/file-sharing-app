<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distributed File Sharing System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #38a169;
            --error-color: #e53e3e;
            --warning-color: #dd6b20;
            --bg-primary: #f7fafc;
            --bg-secondary: #edf2f7;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 15px 35px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .app-header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .app-header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .panel h2 {
            margin-bottom: 25px;
            color: var(--text-primary);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tabs {
            display: flex;
            margin-bottom: 25px;
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 5px;
        }

        .tab {
            flex: 1;
            padding: 10px 15px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab.active {
            background: white;
            color: var(--primary-color);
            box-shadow: var(--shadow);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #718096 0%, #4a5568 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #48bb78 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error-color) 0%, #f56565 100%);
        }

        .file-drop-zone {
            border: 3px dashed var(--border-color);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--bg-primary);
        }

        .file-drop-zone:hover,
        .file-drop-zone.dragover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
        }

        .file-input {
            display: none;
        }

        .peer-id-display {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-indicator.offline { background: #cbd5e0; animation: none; }
        .status-indicator.connecting { background: var(--warning-color); }
        .status-indicator.online { background: var(--success-color); }
        .status-indicator.error { background: var(--error-color); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .progress-container {
            margin: 20px 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
            display: flex;
            justify-content: space-between;
        }

        .file-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .file-item {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-info h4 {
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .file-info small {
            color: var(--text-secondary);
        }

        .file-actions {
            display: flex;
            gap: 5px;
        }

        .file-actions .btn {
            padding: 5px 10px;
            font-size: 0.8rem;
            margin: 0;
        }

        .peer-list {
            margin-top: 20px;
        }

        .peer-item {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .peer-info {
            flex: 1;
        }

        .peer-info h4 {
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .peer-info small {
            color: var(--text-secondary);
        }

        .statistics-panel {
            grid-column: 1 / -1;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .log-container {
            background: #1a202c;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            height: 250px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.error { color: #feb2b2; }
        .log-entry.success { color: #9ae6b4; }
        .log-entry.info { color: #90cdf4; }
        .log-entry.warning { color: #fbb6ce; }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: var(--success-color); }
        .notification.error { background: var(--error-color); }
        .notification.info { background: var(--primary-color); }
        .notification.warning { background: var(--warning-color); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .app-header h1 {
                font-size: 2rem;
            }
            
            .panel {
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <h1>üåê Distributed File Sharing</h1>
            <p>Secure, decentralized file sharing with WebRTC technology</p>
        </div>

        <div class="main-grid">
            <!-- Connection Panel -->
            <div class="panel">
                <h2>
                    <span>üîó</span>
                    Network Connection
                </h2>

                <div class="tabs">
                    <div class="tab active" data-tab="connect">Connect</div>
                    <div class="tab" data-tab="host">Host Room</div>
                    <div class="tab" data-tab="discover">Discover</div>
                </div>

                <!-- Connect Tab -->
                <div class="tab-content active" id="connect-tab">
                    <div class="form-group">
                        <label>Your Peer ID:</label>
                        <div class="peer-id-display" id="myPeerId">
                            Generating...
                            <button class="btn copy-btn" id="copyPeerBtn">Copy</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="remotePeerId">Connect to Peer:</label>
                        <input type="text" id="remotePeerId" placeholder="Enter peer ID or room code">
                    </div>

                    <button class="btn" id="connectBtn">
                        <span>üîå</span> Connect
                    </button>
                    <button class="btn btn-secondary" id="disconnectBtn" disabled>
                        <span>‚ùå</span> Disconnect
                    </button>

                    <div style="margin-top: 20px;">
                        <p>
                            <span class="status-indicator offline" id="statusIndicator"></span>
                            <span id="connectionStatus">Offline</span>
                        </p>
                    </div>
                </div>

                <!-- Host Room Tab -->
                <div class="tab-content" id="host-tab">
                    <div class="form-group">
                        <label for="roomName">Room Name:</label>
                        <input type="text" id="roomName" placeholder="Enter room name">
                    </div>

                    <div class="form-group">
                        <label for="roomPassword">Password (Optional):</label>
                        <input type="password" id="roomPassword" placeholder="Enter room password">
                    </div>

                    <div class="form-group">
                        <label for="maxPeers">Max Peers:</label>
                        <select id="maxPeers">
                            <option value="5">5 peers</option>
                            <option value="10">10 peers</option>
                            <option value="20">20 peers</option>
                            <option value="50">50 peers</option>
                        </select>
                    </div>

                    <button class="btn btn-success" id="createRoomBtn">
                        <span>üè†</span> Create Room
                    </button>
                    <button class="btn btn-danger" id="closeRoomBtn" disabled>
                        <span>üö™</span> Close Room
                    </button>
                </div>

                <!-- Discover Tab -->
                <div class="tab-content" id="discover-tab">
                    <button class="btn" id="discoverPeersBtn">
                        <span>üîç</span> Discover Peers
                    </button>
                    <button class="btn btn-secondary" id="refreshPeersBtn">
                        <span>üîÑ</span> Refresh
                    </button>

                    <div class="peer-list" id="discoveredPeers">
                        <h3>Available Peers & Rooms</h3>
                        <div id="peerItems"></div>
                    </div>
                </div>
            </div>

            <!-- File Sharing Panel -->
            <div class="panel">
                <h2>
                    <span>üìÅ</span>
                    File Management
                </h2>

                <div class="tabs">
                    <div class="tab active" data-file-tab="send">Send</div>
                    <div class="tab" data-file-tab="receive">Receive</div>
                    <div class="tab" data-file-tab="shared">Shared</div>
                </div>

                <!-- Send Files Tab -->
                <div class="tab-content active" id="send-tab">
                    <div class="file-drop-zone" id="fileDropZone">
                        <p>üìé Click to select files or drag & drop</p>
                        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 10px;">
                            Supports all file types ‚Ä¢ Max: 1GB per file
                        </p>
                    </div>
                    <input type="file" id="fileInput" class="file-input" multiple>

                    <div class="form-group">
                        <label for="fileDescription">Description (Optional):</label>
                        <textarea id="fileDescription" rows="3" placeholder="Add a description for your files..."></textarea>
                    </div>

                    <div class="file-list" id="selectedFiles"></div>

                    <button class="btn btn-success" id="sendBtn" disabled>
                        <span>üì§</span> Send Files
                    </button>
                    <button class="btn btn-secondary" id="clearFilesBtn">
                        <span>üóëÔ∏è</span> Clear
                    </button>

                    <div class="progress-container" id="sendProgress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="sendProgressFill"></div>
                        </div>
                        <div class="progress-text">
                            <span id="sendProgressText">0%</span>
                            <span id="sendProgressSpeed">0 KB/s</span>
                        </div>
                    </div>
                </div>

                <!-- Receive Files Tab -->
                <div class="tab-content" id="receive-tab">
                    <div class="file-list" id="incomingFiles">
                        <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            No incoming files
                        </p>
                    </div>
                </div>

                <!-- Shared Files Tab -->
                <div class="tab-content" id="shared-tab">
                    <button class="btn" id="refreshSharedBtn">
                        <span>üîÑ</span> Refresh
                    </button>
                    <button class="btn btn-secondary" id="clearSharedBtn">
                        <span>üóëÔ∏è</span> Clear All
                    </button>

                    <div class="file-list" id="sharedFiles">
                        <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            No shared files
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Panel -->
        <div class="panel statistics-panel">
            <h2>
                <span>üìä</span>
                System Statistics & Activity Log
            </h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalPeers">0</div>
                    <div class="stat-label">Connected Peers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalFiles">0</div>
                    <div class="stat-label">Files Transferred</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalData">0 MB</div>
                    <div class="stat-label">Data Transferred</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgSpeed">0 KB/s</div>
                    <div class="stat-label">Average Speed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="uptime">00:00:00</div>
                    <div class="stat-label">Session Time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="networkStatus">Offline</div>
                    <div class="stat-label">Network Status</div>
                </div>
            </div>

            <div>
                <h3 style="margin-bottom: 15px;">Activity Log</h3>
                <div class="log-container" id="logContainer"></div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- File Preview Modal -->
    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="previewTitle">File Preview</h3>
                <button class="close-btn" id="closePreviewBtn">&times;</button>
            </div>
            <div id="previewContent"></div>
        </div>
    </div>

    <!-- Room Info Modal -->
    <div class="modal" id="roomModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Room Information</h3>
                <button class="close-btn" id="closeRoomInfoBtn">&times;</button>
            </div>
            <div id="roomContent">
                <div class="form-group">
                    <label>Room Code:</label>
                    <div class="peer-id-display" id="roomCode">
                        <button class="btn copy-btn" id="copyRoomCodeBtn">Copy</button>
                    </div>
                </div>
                <div class="peer-list" id="roomPeers">
                    <h4>Connected Peers (0)</h4>
                    <div id="roomPeerItems"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application state
        const appState = {
            peerId: null,
            connectedPeers: new Map(),
            files: {
                selected: [],
                shared: [],
                incoming: []
            },
            rooms: {
                current: null,
                created: []
            },
            stats: {
                connectedPeers: 0,
                totalFiles: 0,
                totalData: 0,
                averageSpeed: 0,
                sessionStartTime: Date.now(),
                transferHistory: []
            },
            sessionStartTime: Date.now(),
            status: 'offline'
        };

        // Initialize the application
        function initApp() {
            generatePeerId();
            setupEventListeners();
            updateConnectionStatus('offline');
            updateStatistics();
            startUptimeCounter();
            log('Application initialized', 'success');
            showNotification('System ready for file sharing!', 'success');
        }

        // Generate a unique peer ID
        function generatePeerId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let id = 'PEER-';
            for (let i = 0; i < 12; i++) {
                id += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            appState.peerId = id;
            document.getElementById('myPeerId').innerHTML = id + '<button class="btn copy-btn" id="copyPeerBtn">Copy</button>';
        }

        // Setup event listeners
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('[data-tab]').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchTab(tab.dataset.tab);
                });
            });
            
            document.querySelectorAll('[data-file-tab]').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchFileTab(tab.dataset.fileTab);
                });
            });
            
            // Connection management
            document.getElementById('connectBtn').addEventListener('click', connectToPeer);
            document.getElementById('disconnectBtn').addEventListener('click', disconnect);
            
            // Room management
            document.getElementById('createRoomBtn').addEventListener('click', createRoom);
            document.getElementById('closeRoomBtn').addEventListener('click', closeRoom);
            
            // Peer discovery
            document.getElementById('discoverPeersBtn').addEventListener('click', discoverPeers);
            document.getElementById('refreshPeersBtn').addEventListener('click', refreshPeers);
            
            // File handling
            document.getElementById('fileDropZone').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
            
            document.getElementById('fileInput').addEventListener('change', handleFileSelection);
            
            // Drag and drop
            const dropZone = document.getElementById('fileDropZone');
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                handleFileSelection(e);
            });
            
            document.getElementById('sendBtn').addEventListener('click', sendFiles);
            document.getElementById('clearFilesBtn').addEventListener('click', clearFiles);
            
            // Shared files
            document.getElementById('refreshSharedBtn').addEventListener('click', refreshSharedFiles);
            document.getElementById('clearSharedBtn').addEventListener('click', clearSharedFiles);
            
            // Modals
            document.getElementById('closePreviewBtn').addEventListener('click', () => closeModal('previewModal'));
            document.getElementById('closeRoomInfoBtn').addEventListener('click', () => closeModal('roomModal'));
            
            // Copy buttons
            document.getElementById('copyPeerBtn').addEventListener('click', copyPeerId);
            document.getElementById('copyRoomCodeBtn').addEventListener('click', copyRoomCode);
        }

        // Switch between tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Switch between file tabs
        function switchFileTab(tabName) {
            document.querySelectorAll('[data-file-tab]').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.tab[data-file-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Copy peer ID to clipboard
        function copyPeerId() {
            navigator.clipboard.writeText(appState.peerId);
            showNotification('Peer ID copied to clipboard!', 'success');
        }

        // Connect to a peer
        function connectToPeer() {
            const remotePeerId = document.getElementById('remotePeerId').value.trim();
            
            if (!remotePeerId) {
                showNotification('Please enter a peer ID', 'warning');
                return;
            }
            
            if (remotePeerId === appState.peerId) {
                showNotification('Cannot connect to yourself', 'error');
                return;
            }
            
            updateConnectionStatus('connecting');
            
            // Simulate connection process
            setTimeout(() => {
                if (Math.random() > 0.1) { // 90% success rate simulation
                    appState.connectedPeers.set(remotePeerId, {
                        id: remotePeerId,
                        status: 'connected',
                        connectionTime: new Date()
                    });
                    
                    updateConnectionStatus('online');
                    document.getElementById('disconnectBtn').disabled = false;
                    showNotification(`Connected to ${remotePeerId}`, 'success');
                    log(`Connected to peer: ${remotePeerId}`, 'success');
                    
                    // Update statistics
                    appState.stats.connectedPeers = appState.connectedPeers.size;
                    updateStatistics();
                } else {
                    updateConnectionStatus('offline');
                    showNotification('Connection failed. Peer not found.', 'error');
                    log(`Connection to ${remotePeerId} failed`, 'error');
                }
            }, 2000);
        }

        // Disconnect from peers
        function disconnect() {
            appState.connectedPeers.clear();
            updateConnectionStatus('offline');
            document.getElementById('disconnectBtn').disabled = true;
            showNotification('Disconnected from all peers', 'info');
            log('Disconnected from all peers', 'info');
            
            // Update statistics
            appState.stats.connectedPeers = 0;
            updateStatistics();
        }

        // Update connection status UI
        function updateConnectionStatus(status) {
            appState.status = status;
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('connectionStatus');
            
            indicator.className = 'status-indicator';
            indicator.classList.add(status);
            
            const statusMap = {
                'offline': 'Offline',
                'connecting': 'Connecting...',
                'online': 'Online',
                'error': 'Connection Error'
            };
            
            statusText.textContent = statusMap[status];
        }

        // Create a new room
        function createRoom() {
            const roomName = document.getElementById('roomName').value.trim();
            const password = document.getElementById('roomPassword').value;
            const maxPeers = document.getElementById('maxPeers').value;
            
            if (!roomName) {
                showNotification('Please enter a room name', 'warning');
                return;
            }
            
            const roomCode = `ROOM-${Math.random().toString(36).substring(2, 8).toUpperCase()}`;
            appState.rooms.current = {
                id: roomCode,
                name: roomName,
                password: password,
                maxPeers: parseInt(maxPeers),
                peers: [appState.peerId],
                created: new Date()
            };
            
            appState.rooms.created.push(appState.rooms.current);
            
            // Enable close room button
            document.getElementById('closeRoomBtn').disabled = false;
            
            // Show room info
            document.getElementById('roomCode').innerHTML = roomCode + '<button class="btn copy-btn" id="copyRoomCodeBtn">Copy</button>';
            updateRoomPeers();
            openModal('roomModal');
            
            showNotification(`Room "${roomName}" created!`, 'success');
            log(`Room created: ${roomName} (${roomCode})`, 'success');
        }

        // Close current room
        function closeRoom() {
            if (!appState.rooms.current) return;
            
            const roomName = appState.rooms.current.name;
            appState.rooms.current = null;
            document.getElementById('closeRoomBtn').disabled = true;
            showNotification(`Room "${roomName}" closed`, 'info');
            log(`Room closed: ${roomName}`, 'info');
        }

        // Copy room code to clipboard
        function copyRoomCode() {
            if (!appState.rooms.current) return;
            navigator.clipboard.writeText(appState.rooms.current.id);
            showNotification('Room code copied to clipboard!', 'success');
        }

        // Update room peers list
        function updateRoomPeers() {
            if (!appState.rooms.current) return;
            
            const container = document.getElementById('roomPeerItems');
            container.innerHTML = '';
            
            appState.rooms.current.peers.forEach(peerId => {
                const peerEl = document.createElement('div');
                peerEl.className = 'peer-item';
                peerEl.innerHTML = `
                    <div class="peer-info">
                        <h4>${peerId}</h4>
                        <small>Connected</small>
                    </div>
                    <div class="peer-actions">
                        <button class="btn btn-secondary" onclick="removePeerFromRoom('${peerId}')">Remove</button>
                    </div>
                `;
                container.appendChild(peerEl);
            });
            
            document.querySelector('#roomPeers h4').textContent = 
                `Connected Peers (${appState.rooms.current.peers.length})`;
        }

        // Remove peer from room
        function removePeerFromRoom(peerId) {
            if (!appState.rooms.current) return;
            
            const index = appState.rooms.current.peers.indexOf(peerId);
            if (index !== -1) {
                appState.rooms.current.peers.splice(index, 1);
                updateRoomPeers();
                log(`Peer ${peerId} removed from room`, 'info');
            }
        }

        // Discover peers
        function discoverPeers() {
            const peerItems = document.getElementById('peerItems');
            peerItems.innerHTML = '';
            
            // Simulate discovering peers
            const peers = [
                { id: 'PEER-ABC123DEF456', type: 'peer', status: 'online' },
                { id: 'ROOM-XYZ789', type: 'room', name: 'Project Files', peers: 3, protected: false },
                { id: 'PEER-GHI789JKL012', type: 'peer', status: 'online' },
                { id: 'ROOM-123ABC', type: 'room', name: 'Team Documents', peers: 5, protected: true },
                { id: 'PEER-MNO345PQR678', type: 'peer', status: 'offline' }
            ];
            
            peers.forEach(peer => {
                const peerEl = document.createElement('div');
                peerEl.className = 'peer-item';
                
                if (peer.type === 'peer') {
                    peerEl.innerHTML = `
                        <div class="peer-info">
                            <h4>${peer.id}</h4>
                            <small>Status: <span class="${peer.status}">${peer.status}</span></small>
                        </div>
                        <div class="peer-actions">
                            <button class="btn" onclick="connectToDiscoveredPeer('${peer.id}')">Connect</button>
                        </div>
                    `;
                } else {
                    peerEl.innerHTML = `
                        <div class="peer-info">
                            <h4>${peer.name} (${peer.id})</h4>
                            <small>${peer.peers} peers ‚Ä¢ ${peer.protected ? 'üîí Password protected' : 'Open access'}</small>
                        </div>
                        <div class="peer-actions">
                            <button class="btn" onclick="joinRoom('${peer.id}')">Join</button>
                        </div>
                    `;
                }
                
                peerItems.appendChild(peerEl);
            });
            
            showNotification('Discovered available peers and rooms', 'info');
        }

        // Refresh peers list
        function refreshPeers() {
            discoverPeers();
            showNotification('Peer list refreshed', 'info');
        }

        // Connect to discovered peer
        function connectToDiscoveredPeer(peerId) {
            document.getElementById('remotePeerId').value = peerId;
            connectToPeer();
        }

        // Join a room
        function joinRoom(roomId) {
            document.getElementById('remotePeerId').value = roomId;
            connectToPeer();
        }

        // Handle file selection
        function handleFileSelection(event) {
            const files = event.target?.files || event.dataTransfer?.files;
            if (!files || files.length === 0) return;
            
            const container = document.getElementById('selectedFiles');
            container.innerHTML = '';
            
            Array.from(files).forEach(file => {
                appState.files.selected.push(file);
                
                const fileEl = document.createElement('div');
                fileEl.className = 'file-item';
                fileEl.innerHTML = `
                    <div class="file-info">
                        <h4>${file.name}</h4>
                        <small>${formatFileSize(file.size)}</small>
                    </div>
                    <div class="file-actions">
                        <button class="btn btn-danger" onclick="removeSelectedFile('${file.name}')">Remove</button>
                    </div>
                `;
                container.appendChild(fileEl);
            });
            
            document.getElementById('sendBtn').disabled = false;
            showNotification(`${files.length} file(s) selected`, 'success');
        }

        // Remove a selected file
        function removeSelectedFile(fileName) {
            appState.files.selected = appState.files.selected.filter(file => file.name !== fileName);
            
            if (appState.files.selected.length === 0) {
                document.getElementById('selectedFiles').innerHTML = '';
                document.getElementById('sendBtn').disabled = true;
                return;
            }
            
            // Rebuild file list
            const container = document.getElementById('selectedFiles');
            container.innerHTML = '';
            
            appState.files.selected.forEach(file => {
                const fileEl = document.createElement('div');
                fileEl.className = 'file-item';
                fileEl.innerHTML = `
                    <div class="file-info">
                        <h4>${file.name}</h4>
                        <small>${formatFileSize(file.size)}</small>
                    </div>
                    <div class="file-actions">
                        <button class="btn btn-danger" onclick="removeSelectedFile('${file.name}')">Remove</button>
                    </div>
                `;
                container.appendChild(fileEl);
            });
        }

        // Send selected files
        function sendFiles() {
            if (appState.files.selected.length === 0) return;
            if (appState.connectedPeers.size === 0 && !appState.rooms.current) {
                showNotification('Not connected to any peers', 'error');
                return;
            }
            
            const description = document.getElementById('fileDescription').value || 'No description';
            
            // Show progress bar
            const progressContainer = document.getElementById('sendProgress');
            progressContainer.style.display = 'block';
            
            // Simulate file transfer
            let progress = 0;
            const totalSize = appState.files.selected.reduce((sum, file) => sum + file.size, 0);
            let transferred = 0;
            let startTime = Date.now();
            
            const interval = setInterval(() => {
                progress += Math.random() * 5;
                if (progress > 100) progress = 100;
                
                document.getElementById('sendProgressFill').style.width = progress + '%';
                document.getElementById('sendProgressText').textContent = Math.round(progress) + '%';
                
                // Calculate transfer speed
                transferred = (totalSize * progress) / 100;
                const elapsed = (Date.now() - startTime) / 1000;
                const speed = elapsed > 0 ? transferred / elapsed : 0;
                
                document.getElementById('sendProgressSpeed').textContent = formatFileSize(speed) + '/s';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Add to shared files
                    appState.files.selected.forEach(file => {
                        const sharedFile = {
                            id: generateFileId(),
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            description: description,
                            timestamp: new Date(),
                            peers: Array.from(appState.connectedPeers.keys())
                        };
                        
                        appState.files.shared.push(sharedFile);
                    });
                    
                    // Update statistics
                    appState.stats.totalFiles += appState.files.selected.length;
                    appState.stats.totalData += totalSize;
                    updateStatistics();
                    
                    // Show success message
                    showNotification('Files sent successfully!', 'success');
                    log(`Sent ${appState.files.selected.length} file(s) to peers`, 'success');
                    
                    // Reset UI
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                        document.getElementById('sendProgressFill').style.width = '0%';
                        document.getElementById('fileDescription').value = '';
                        clearFiles();
                    }, 2000);
                }
            }, 200);
        }

        // Clear selected files
        function clearFiles() {
            appState.files.selected = [];
            document.getElementById('selectedFiles').innerHTML = '';
            document.getElementById('sendBtn').disabled = true;
            document.getElementById('fileInput').value = '';
        }

        // Refresh shared files
        function refreshSharedFiles() {
            updateSharedFilesList();
            showNotification('Shared files refreshed', 'info');
        }

        // Clear shared files
        function clearSharedFiles() {
            if (appState.files.shared.length === 0) return;
            
            appState.files.shared = [];
            updateSharedFilesList();
            showNotification('All shared files cleared', 'info');
        }

        // Update shared files list
        function updateSharedFilesList() {
            const container = document.getElementById('sharedFiles');
            
            if (appState.files.shared.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">No shared files</p>';
                return;
            }
            
            container.innerHTML = '';
            appState.files.shared.forEach(file => {
                const fileEl = document.createElement('div');
                fileEl.className = 'file-item';
                fileEl.innerHTML = `
                    <div class="file-info">
                        <h4>${file.name}</h4>
                        <small>${formatFileSize(file.size)} ‚Ä¢ ${file.timestamp.toLocaleString()}</small>
                        <p>${file.description}</p>
                    </div>
                    <div class="file-actions">
                        <button class="btn" onclick="downloadFile('${file.id}')">Download</button>
                        <button class="btn btn-danger" onclick="removeSharedFile('${file.id}')">Remove</button>
                    </div>
                `;
                container.appendChild(fileEl);
            });
        }

        // Download file
        function downloadFile(fileId) {
            const file = appState.files.shared.find(f => f.id === fileId);
            if (!file) return;
            
            // In a real app, this would download the actual file
            // For demo, we'll just show a notification
            showNotification(`Downloading ${file.name}...`, 'info');
            log(`Download requested for file: ${file.name}`, 'info');
        }

        // Remove shared file
        function removeSharedFile(fileId) {
            appState.files.shared = appState.files.shared.filter(f => f.id !== fileId);
            updateSharedFilesList();
            showNotification('File removed from shared files', 'info');
        }

        // Generate unique file ID
        function generateFileId() {
            return 'FILE-' + Math.random().toString(36).substring(2, 10);
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            if (bytes < 1073741824) return (bytes / 1048576).toFixed(1) + ' MB';
            return (bytes / 1073741824).toFixed(1) + ' GB';
        }

        // Update statistics display
        function updateStatistics() {
            document.getElementById('totalPeers').textContent = appState.connectedPeers.size;
            document.getElementById('totalFiles').textContent = appState.stats.totalFiles;
            document.getElementById('totalData').textContent = (appState.stats.totalData / 1048576).toFixed(1) + ' MB';
            document.getElementById('avgSpeed').textContent = '0 KB/s'; // Simplified for demo
            document.getElementById('networkStatus').textContent = appState.status.charAt(0).toUpperCase() + appState.status.slice(1);
        }

        // Start uptime counter
        function startUptimeCounter() {
            setInterval(() => {
                const elapsed = Math.floor((Date.now() - appState.sessionStartTime) / 1000);
                const hours = Math.floor(elapsed / 3600);
                const minutes = Math.floor((elapsed % 3600) / 60);
                const seconds = elapsed % 60;
                
                document.getElementById('uptime').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Add log entry
        function log(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        // Show notification
        function showNotification(message, type) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 10);
            
            // Remove after delay
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Open modal
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>